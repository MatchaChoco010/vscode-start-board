# Implementation Plan

## Tasks

- [x] 1. Extension基盤セットアップ
- [x] 1.1 拡張機能のエントリーポイントと設定を構築する
  - package.jsonにactivationEvents（onStartupFinished）を設定する
  - contributes.configurationでアスキーアート設定項目（text, fontFamily, fontSize, lineHeight）を定義する
  - contributes.commandsでプロジェクト追加コマンドとダッシュボード表示コマンドを登録する
  - extension.tsでactivate関数を実装し、コンポーネントの初期化順序を設定する
  - _Requirements: 1.1, 2.2, 2.3, 2.4, 2.5, 4.1_

- [x] 2. データストレージ実装
- [x] 2.1 (P) プロジェクトリストの永続化機能を実装する
  - globalStateを使用してプロジェクト配列を保存・読み込みする
  - プロジェクトの追加・削除・一覧取得の操作を実装する
  - 同一パスのプロジェクトが既に存在する場合の重複チェックを実装する
  - UUID生成によるプロジェクトID付与を実装する
  - 拡張機能起動時にストレージからプロジェクトリストを読み込む
  - _Requirements: 3.1, 3.2, 3.3, 3.4, 4.4_

- [x] 2.2 (P) ユーザー設定の読み取りと変更監視機能を実装する
  - workspace.getConfigurationでアスキーアート設定を取得する
  - 設定項目のデフォルト値を定義する（text: "Welcome", fontFamily: "monospace", fontSize: 14, lineHeight: 1.2）
  - onDidChangeConfigurationイベントで設定変更を監視する
  - 設定変更時にWebviewへ更新を通知するコールバックを提供する
  - _Requirements: 2.2, 2.3, 2.4, 2.5, 2.6_

- [x] 3. Webview管理実装
- [x] 3.1 Webviewパネルのライフサイクル管理を実装する
  - createWebviewPanelでダッシュボードパネルを作成する
  - enableScripts: trueでJavaScript実行を許可する
  - retainContextWhenHiddenでWebview状態を保持する
  - パネルの破棄イベント（onDidDispose）でクリーンアップを実行する
  - 単一インスタンスを保証し、既存パネルがあれば再表示する
  - _Requirements: 1.1, 1.2_

- [x] 3.2 Extension ⇔ Webview間のメッセージ通信を実装する
  - 初期化メッセージ（init）でプロジェクトリストと設定を送信する
  - プロジェクト更新メッセージ（projectsUpdated）で一覧を同期する
  - 設定更新メッセージ（configUpdated）でアスキーアート設定を反映する
  - Webviewからのプロジェクト操作メッセージ（openProject, deleteProject）を受信・処理する
  - Webview準備完了メッセージ（ready）で初期データ送信をトリガーする
  - _Requirements: 2.6, 5.1, 6.3, 7.1_

- [x] 4. ダッシュボードUI実装
- [x] 4.1 (P) ダッシュボードの基本レイアウトを構築する
  - HTMLテンプレートでスプラッシュエリアとプロジェクトリストエリアを配置する
  - VSCodeテーマ変数（--vscode-*）を使用してテーマに対応する
  - フレックスボックスで縦方向にエリアを配置する
  - Content Security Policyを設定してセキュリティを確保する
  - acquireVsCodeApiでVSCode APIインスタンスを取得する
  - _Requirements: 1.2, 1.3_

- [x] 4.2 (P) アスキーアートスプラッシュスクリーンを実装する
  - preタグでアスキーアートテキストを表示する
  - 設定から取得したフォントファミリーを適用する
  - 設定から取得したフォントサイズをピクセル単位で適用する
  - 設定から取得したライン幅（line-height）を適用する
  - テキストを中央に配置する
  - 設定更新メッセージ受信時に表示を更新する
  - _Requirements: 2.1, 2.2, 2.3, 2.4, 2.5, 2.6_

- [x] 4.3 プロジェクト一覧コンポーネントを実装する
  - プロジェクト配列を受け取り、リスト形式で表示する
  - 各プロジェクト項目にプロジェクト名とパスを表示する
  - プロジェクトが空の場合は「プロジェクトがありません」のメッセージを表示する
  - プロジェクト更新メッセージ受信時にリストを再描画する
  - _Requirements: 5.1, 5.2, 5.3_

- [x] 5. ユーザー操作機能実装
- [x] 5.1 現在のワークスペース/フォルダをプロジェクトとして追加するコマンドを実装する
  - workspace.workspaceFoldersから現在開いているフォルダを取得する
  - ワークスペースファイルが開かれている場合はworkspace.workspaceFileから取得する
  - フォルダもワークスペースも開かれていない場合はエラーメッセージを表示する
  - プロジェクトをストレージに追加し、成功メッセージを表示する
  - ダッシュボードが表示中の場合は更新メッセージを送信する
  - _Requirements: 4.1, 4.2, 4.3, 4.4_

- [x] 5.2 プロジェクト削除機能を実装する
  - プロジェクト項目のホバー時に削除ボタン（×）を表示する（CSSの:hover）
  - 削除ボタンクリック時にWebview内で確認ダイアログを表示する
  - 確認ダイアログで「削除」選択時にdeleteProjectメッセージを送信する
  - 確認ダイアログで「キャンセル」選択時は何もせずダイアログを閉じる
  - Extension側でストレージからプロジェクトを削除し、更新メッセージを送信する
  - _Requirements: 6.1, 6.2, 6.3, 6.4_

- [x] 5.3 プロジェクトを開く機能を実装する
  - プロジェクト項目クリック時にopenProjectメッセージを送信する
  - Extension側でプロジェクトIDからパスを取得する
  - vscode.workspace.fs.statでパスの存在を確認する
  - パスが存在しない場合はエラーメッセージを表示し、削除オプションを提示する
  - typeがfolderの場合はvscode.commands.executeCommand('vscode.openFolder')を実行する
  - typeがworkspaceの場合はvscode.commands.executeCommand('vscode.openFolder', uri, false)を実行する
  - プロジェクトが開かれた後、ダッシュボードパネルは自動的に閉じる
  - _Requirements: 7.1, 7.2, 7.3_

- [x] 6. 空ウィンドウ検出と自動表示
- [x] 6.1 空のウィンドウを検出してダッシュボードを自動表示する
  - onStartupFinishedイベントでワークスペース状態をチェックする
  - workspace.workspaceFoldersがundefinedまたは空配列の場合を空ウィンドウと判定する
  - 空ウィンドウと判定された場合、ダッシュボードを自動的に表示する
  - ダッシュボードをエディター領域の中央に全画面で表示する
  - _Requirements: 1.1, 1.2, 1.3_

- [x] 7. テストと検証
- [x] 7.1 (P) ProjectStorageのユニットテストを実装する
  - プロジェクトの追加・取得・削除の基本操作をテストする
  - 同一パスの重複チェックが機能することをテストする
  - 空のリストからの取得が正しく動作することをテストする
  - globalStateのモックを使用してテストを分離する
  - _Requirements: 3.1, 3.2, 3.3, 3.4, 4.4_

- [x] 7.2 (P) ConfigurationManagerのユニットテストを実装する
  - デフォルト設定値が正しく返されることをテストする
  - カスタム設定値が正しく取得されることをテストする
  - workspace.getConfigurationのモックを使用してテストを分離する
  - _Requirements: 2.2, 2.3, 2.4, 2.5_

- [x] 7.3 CommandHandlersの統合テストを実装する
  - プロジェクト追加コマンドがStorageと連携することをテストする
  - ワークスペース未オープン時のエラーハンドリングをテストする
  - 重複追加時の警告メッセージをテストする
  - _Requirements: 4.1, 4.2, 4.3, 4.4_

- [x] 7.4 手動検証チェックリストを作成する
  - 空のウィンドウ起動時にダッシュボードが表示されることを確認する
  - プロジェクト追加コマンド実行後、リストが更新されることを確認する
  - プロジェクトクリック後、対象のフォルダ/ワークスペースが開かれることを確認する
  - 削除ボタンクリック後、確認ダイアログを経て削除されることを確認する
  - 設定変更後、アスキーアートが更新されることを確認する
  - _Requirements: 1.1, 2.6, 4.2, 6.3, 7.1_

## Requirements Coverage

| Requirement | Tasks |
|-------------|-------|
| 1.1 | 1.1, 3.1, 6.1, 7.4 |
| 1.2 | 1.1, 3.1, 4.1, 6.1 |
| 1.3 | 1.1, 4.1, 6.1 |
| 2.1 | 4.2 |
| 2.2 | 1.1, 2.2, 4.2, 7.2 |
| 2.3 | 1.1, 2.2, 4.2, 7.2 |
| 2.4 | 1.1, 2.2, 4.2, 7.2 |
| 2.5 | 1.1, 2.2, 4.2, 7.2 |
| 2.6 | 2.2, 3.2, 4.2, 7.4 |
| 3.1 | 2.1, 7.1 |
| 3.2 | 2.1, 7.1 |
| 3.3 | 2.1, 7.1 |
| 3.4 | 2.1, 7.1 |
| 4.1 | 1.1, 5.1, 7.3 |
| 4.2 | 5.1, 7.3, 7.4 |
| 4.3 | 5.1, 7.3 |
| 4.4 | 2.1, 5.1, 7.1, 7.3 |
| 5.1 | 3.2, 4.3 |
| 5.2 | 4.3 |
| 5.3 | 4.3 |
| 6.1 | 5.2 |
| 6.2 | 5.2 |
| 6.3 | 3.2, 5.2, 7.4 |
| 6.4 | 5.2 |
| 7.1 | 3.2, 5.3, 7.4 |
| 7.2 | 5.3 |
| 7.3 | 5.3 |
